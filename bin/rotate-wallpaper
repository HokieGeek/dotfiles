#!/bin/sh

me="$(cd `dirname $0`; pwd)/`basename $0`"
dirs="$1"
[ "$2" = "--cron" ] && {
    cronjobs=/tmp/cronjobs.$$
    crontab -l > $cronjobs
    echo '*/30 * * * * DISPLAY=:0.0 '$me' '$dirs >> $cronjobs
    crontab < $cronjobs
    crontab -l
    exit 0
}
last=/tmp/rotate-wallpaper.last
[ ! -f $last ] && echo "-" > $last
sel=`find $dirs -type f ! -wholename "$(cat $last)" -print | shuf -n1`
echo $sel > $last
feh --bg-fill $sel
