#!/bin/sh

dirs="$1"
[ "$2" = "--cron" ] && {
    cronjobs=/tmp/cronjobs.$$
    crontab -l > $cronjobs
    echo "0 */4 * * * /home/andres/.bin/rotate-wallpaper $dirs" >> $cronjobs
    crontab < $cronjobs
    crontab -l
    exit 0
}

last=/tmp/rotate-wallpaper.last
[ ! -f $last ] && echo "-" > $last
sel=`find $dirs -type f ! -wholename "$(cat $last)" -print | shuf -n1`
echo $sel > $last
feh --bg-fill $sel
