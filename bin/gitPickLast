#!/bin/bash

# 1. Get the sha for the last commit
last_commit=`git log -p -1 --exit-code HEAD | grep commit | awk '{ print $2 }'`
echo "LAST COMMIT: $last_commit"

# 2. Stash all changes
git stash save gitPickLast

# 3. Switch to master
git checkout master

# 4. Perform a cherry-pick
git cherry-pick $last_commit

# 5. Push it
$HOME/.bin/gitPull && $HOME/.bin/gitPush

# last. Unstash any stashed changes
if [ `git stash list | head -1 | cut -d: -f3 | grep -c "gitPickLast"` -ge 1 ];  then
    stash_pos=`git stash list | grep gitPickLast | cut -d: -f1 | sed 's/stash@{\([0-9]*\)}/\1/g '`
    git stash pop "stash@{${stash_pos}}"
fi

