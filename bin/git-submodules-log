#!/bin/sh

if [ $# -le 0 ]; then
    echo "USAGE: git sublog <revision>"
    exit 1
fi

# echo ${rev}
# exit 42

for x in `git diff ${rev}.. | egrep "(diff |-Subproject)" | awk '$1 ~ /diff/ { sub("b/", "", $NF); print $NF } $1 ~ /-Subproject/ { print $NF }' | sed '$!N;s/\n/:/'`; do
    p=`echo $x | cut -d: -f1`
    r=`echo $x | cut -d: -f2`
    echo -en '\033[35m'
    echo "Submodule: ${p}"
    echo "Revision: ${r}"
    echo -en '\033[0m'
    cd ${p}
    git --no-pager log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(cyan)<%an>%Creset' ${r}..
    cd ..
    echo -e "\n"
done | less -R
