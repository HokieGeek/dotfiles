#!/bin/sh

url="https://www.archlinux.org/mirrorlist/?country=US&protocol=http&ip_version=4&use_mirror_status=on"
tmplist=/tmp/list
list=/etc/pacman.d/mirrorlist

## Download the list ranked by status
curl "${url}" -o ${tmplist}

## Process it by uncommenting the top 10 mirrors (with the best score)
sed -i -e '/##/d' -e '/^$/d' ${tmplist} # TODO: this might be overkill?
sed -i '1,8s/^#//' ${tmplist}

## Rank the list by speed
mv ${tmplist} ${tmplist}.status
sudo /usr/bin/rankmirrors -n 8 ${tmplist}.status > ${tmplist}

## Replace the current list with the new list
sudo cp ${list} ${list}.bak
sudo install -Dm644 ${tmplist} ${list}
