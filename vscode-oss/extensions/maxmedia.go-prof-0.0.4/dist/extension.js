module.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t){e.exports=require("vscode")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("os")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.profileCpuBenchmarkCommandName="goprof.profileCpuBenchmark",t.profileMemBenchmarkCommandName="goprof.profileMemBenchmark",t.showProfilersCommandName="goprof.show.profilers"},function(e,t){e.exports=require("child_process")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),r=n(1),s=n(3),i=n(2),a=n(12);let l,c="";function u(e=!0){return e&&l||(l=function(){let e=f(o.workspace.getConfiguration("go").get("toolsGopath")||"");if(!o.workspace.workspaceFolders||o.workspace.workspaceFolders.length<=1)return h(e);if(e.startsWith("~")&&(e=r.join(s.homedir(),e.substr(1))),e&&e.trim()&&!/\${workspaceFolder}|\${workspaceRoot}/.test(e))return e;for(const e of o.workspace.workspaceFolders){let t=o.workspace.getConfiguration("go",e.uri).inspect("toolsGopath").workspaceFolderValue;if(t=h(t,e.uri.fsPath))return t}}()),l||""}function f(e){return e.replace(/\${env:([^}]+)}/g,(e,t)=>process.env[t.trim()]||"")}function h(e,t){return e&&e.trim()?(!t&&o.workspace.workspaceFolders&&(1===o.workspace.workspaceFolders.length?t=o.workspace.rootPath:o.window.activeTextEditor&&o.workspace.getWorkspaceFolder(o.window.activeTextEditor.document.uri)&&(t=o.workspace.getWorkspaceFolder(o.window.activeTextEditor.document.uri).uri.fsPath)),t&&(e=e.replace(/\${workspaceFolder}|\${workspaceRoot}/g,t)),a.resolveHomeDir(e)):e}function d(e){let t="";o.window.activeTextEditor&&(t=o.window.activeTextEditor.document.uri.fsPath,!e&&o.workspace.getWorkspaceFolder(o.window.activeTextEditor.document.uri)&&(e=o.workspace.getWorkspaceFolder(o.window.activeTextEditor.document.uri).uri));const n=o.workspace.getConfiguration("go",e);let s=e?e.fsPath:o.workspace.rootPath;"win32"===process.platform&&(s=a.fixDriveCasingInWindows(s)||"",t=a.fixDriveCasingInWindows(t)||"");const l=a.processEnvGoPath();let u="";if(!0===n.get("inferGopath")){if(!(u=a.getInferredGopath(s)||a.getInferredGopath(t)))try{s&&i.statSync(r.join(s,"src")).isDirectory()&&(u=s)}catch(e){}u&&l&&u!==l&&(u+=r.delimiter+l)}const d=n.get("gopath"),p=d?h(f(d),s):"";return c=u||(p||l)}t.getToolsGopath=u,t.substituteEnv=f,t.resolvePath=h,t.getCurrentGoPath=d,t.getGoConfig=function(){return o.workspace.getConfiguration("go",o.window.activeTextEditor?o.window.activeTextEditor.document.uri:void 0)},t.getBinPath=function(e){const t="go"===e?[]:[u(),d()],n=o.workspace.getConfiguration("go",void 0).get("alternateTools");return a.getBinPathWithPreferredGopath(e,t,n)}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,a)}l((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),s=n(8),i=n(9),a=n(10),l=n(4);function c(e,t,n){let s=".";e&&(s=e),r.window.withProgress({location:r.ProgressLocation.Notification,title:"Running: "+s,cancellable:!0},(e,r)=>o(this,void 0,void 0,function*(){const e=yield a.runProfileAtCursor(s,n);if(e.status){const n=yield a.parseCallGraph(e);t.refreshView(n),yield e.cleanUp()}}))}t.activate=function(e){const t=new s.CallTreeProvider,n={treeDataProvider:t},o=r.window.createTreeView("callGraph",n);t.treeView=o;const a=r.commands.registerCommand(l.profileCpuBenchmarkCommandName,e=>{c(e,t,!1)});e.subscriptions.push(a);const u=r.commands.registerCommand(l.profileMemBenchmarkCommandName,e=>{c(e,t,!0)});e.subscriptions.push(u);const f=new i.ProfileCodeLensProvider;r.languages.registerCodeLensProvider({scheme:"file",language:"go"},f)},t.deactivate=function(){}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0);class r{constructor(e,t){this.label="",this.label=e,this.parent=void 0,this.children=void 0,this.callGraphNode=void 0,this.isCall=t}}t.TreeNode=r;t.CallTreeProvider=class{constructor(){this._onDidChangeTreeData=new o.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this.callGraph=void 0}getPercentStr(e){return e.toFixed(2)+"%"}getValueStr(e,t){return e.toFixed(2)+t}getItemText(e,t,n,o){return this.getPercentStr(t)+" "+e+" "+this.getValueStr(n,o)}getNodeText(e){return this.getItemText(e.name,e.cumPercent,e.cum,e.valueSuffix)}getCallText(e){const t=e.node;return t?this.getItemText(t.name,t.cumPercent,e.calls,t.valueSuffix):""}loadNodes(e,t){let n;for(const o of t){const t=this.getNodeText(o);let s=!1;o.hasCalls&&(s=!0);const i=new r(t,s);i.parent=e,i.callGraphNode=o,n||(n=[]),n.push(i)}return n}loadCalls(e,t){if(!this.callGraph)return;let n;if(t&&t.hasCalls){const o=this.callGraph.getNodeCalls(t.name);for(const t of o){const o=this.getCallText(t);let s=!1;t.node&&t.node.hasCalls&&(s=!0);const i=new r(o,s);i.parent=e,i.callGraphNode=t.node,n||(n=[]),n.push(i)}}return n}refreshView(e){this.callGraph=e,this._rootNodes=void 0,o.commands.executeCommand("setContext","callGraphViewEnabled",!0),this._onDidChangeTreeData.fire(),this.getChildren(void 0).then(e=>{this.reveal()})}reveal(){if(this.treeView&&this._rootNodes&&this._rootNodes.length>0){const e=this._rootNodes[0],t={select:!0,focus:!0,expand:!0};this.treeView.reveal(e,t)}}getTreeItem(e){return{label:e.label,description:"",collapsibleState:e.isCall?o.TreeItemCollapsibleState.Collapsed:void 0,command:void 0}}getParent(e){return e.parent?Promise.resolve(e.parent):Promise.resolve(void 0)}getChildren(e){if(void 0===e&&this._rootNodes)return Promise.resolve(this._rootNodes);if(!this.callGraph)return Promise.resolve(void 0);const t=this.callGraph.getRootNodes();if(!t)return Promise.resolve(void 0);let n;if(void 0===e)n=this.loadNodes(void 0,t),this._rootNodes=n;else{const t=e.callGraphNode;n=this.loadCalls(e,t),e.children=n}return Promise.resolve(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),r=n(4);t.ProfileCodeLensProvider=class{constructor(){this.onDidChangeCodeLensesEmitter=new o.EventEmitter,this.enabled=!0}get onDidChangeCodeLenses(){return this.onDidChangeCodeLensesEmitter.event}setEnabled(e){this.enabled!==e&&(this.enabled=e,this.onDidChangeCodeLensesEmitter.fire())}isSupportedLanguage(e){return!!e&&"go"===e}provideCodeLenses(e,t){const n=e.languageId;if(!this.isSupportedLanguage(n))return;const s=/func (Benchmark.*)\(.*/gi,i=e.getText(),a=[];let l;for(;l=s.exec(i);){const t=e.positionAt(l.index),n=e.positionAt(l.index+l[0].length),s=l[1],i=new o.Range(t,n),c={title:"cpu profile",command:r.profileCpuBenchmarkCommandName,arguments:[s]},u=new o.CodeLens(i,c);a.push(u);const f={title:"mem profile",command:r.profileMemBenchmarkCommandName,arguments:[s]},h=new o.CodeLens(i,f);a.push(h)}return a}resolveCodeLens(e,t){return e}}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,a)}l((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),s=n(5),i=n(1),a=n(2),l=n(3),c=n(11),u=n(6),f=n(13),h="SIGKILL";function d(e){return c.promisify(a.exists)(e)}function p(e){return c.promisify(a.unlink)(e)}class m{constructor(){this.status=!1,this.binPath="",this.profilePath=""}cleanUp(){return o(this,void 0,void 0,function*(){(yield d(this.binPath))&&(yield p(this.binPath)),(yield d(this.profilePath))&&(yield p(this.profilePath))})}}function g(e,t,n){return function(e,t,n){return new Promise((o,c)=>{const f=u.getBinPath("go");if(!f)return r.window.showInformationMessage('Cannot find "go" binary. Update PATH or GOROOT appropriately'),Promise.resolve();const d=["test"];d.push("-bench="+e),function(e,t){return new Promise((n,o)=>{const r=i.join(l.tmpdir(),"goprofiling_");a.mkdtemp(r,(r,s)=>{if(r)return o(r);const a=i.join(s,e),l=i.join(s,t),c=new m;c.binPath=a,c.profilePath=l,n(c)})})}("bin_out","cpu_out").then(e=>{d.push("-o",e.binPath);const i=n?"-memprofile":"-cpuprofile";d.push(i,e.profilePath),e.cleanUp().then(()=>{const n=s.spawn(f,d,{cwd:t});n.on("close",(t,n)=>{t?r.window.showInformationMessage("Error: failed."):n===h?r.window.showInformationMessage("Error: terminated by user."):r.window.showInformationMessage("Success: passed."),e.status=0===t,o(e)})})})})}(e,t,n)}t.ProfileResult=m,t.runProfileAtCursor=function(e,t){return new Promise((n,s)=>{const a=r.window.activeTextEditor,l=new m;if(a){if(!a.document.fileName.endsWith("_test.go"))return r.window.showInformationMessage("No tests found. Current file is not a test file."),void n(l);const s=i.dirname(a.document.fileName);a.document.save().then(()=>o(this,void 0,void 0,function*(){try{const o=yield g(e,s,t);n(o)}catch(e){console.error(e)}}))}else r.window.showInformationMessage("No editor is active."),n(l)})},t.parseCallGraph=function(e){return f.newService().parseCallGraph(e.binPath,e.profilePath)}},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(2),r=n(1),s=n(3);let i={};function a(){return process.env.GOPATH}function l(){return process.env.GOROOT}function c(){return process.env.Path}function u(e,t,n){if(e=function(e){return"win32"===process.platform?e+".exe":e}(e),t){const o=t.split(r.delimiter);for(const t of o){const o=r.join(t,n?"bin":"",e);if(f(o))return o}}return""}function f(e){let t=!0;try{(t=o.statSync(e).isFile())&&o.accessSync(e,o.constants.F_OK|o.constants.X_OK)}catch(e){t=!1}return t}function h(e){return e&&e.trim()&&e.startsWith("~")?r.join(s.homedir(),e.substr(1)):e}function d(e){return e&&"\ufeff"===e[0]&&(e=e.substr(1)),e}function p(e){return"win32"===process.platform&&e?e.substr(0,1).toUpperCase()+e.substr(1):e}t.processEnvGoPath=a,t.processEnvGoRoot=l,t.processEnvPath=c,t.envPath=a()||("win32"===process.platform?c():void 0),t.getBinPathFromEnvVar=u,t.getBinPathWithPreferredGopath=function(e,n,o){if(i[e])return i[e];const s=o&&o[e]?h(o[e]):void 0;if(s&&r.isAbsolute(s)&&f(s))return i[e]=s,s;const a=s&&!r.isAbsolute(s)?s:e;for(const t of n)if("string"==typeof t){const n=u(a,t,!0);if(n)return i[e]=n,n}const c=u(a,l(),!0);if(c)return i[e]=c,c;const d=u(a,t.envPath,!1);if(d)return i[e]=d,d;if("go"===e){const t="win32"===process.platform?"C:\\Go\\bin\\go.exe":"/usr/local/go/bin/go";return f(t)?(i[e]=t,t):void 0}return e},t.clearCacheForTools=function(){i={}},t.resolveHomeDir=h,t.stripBOM=d,t.parseEnvFile=function(e){const t={};if(!e)return t;try{return d(o.readFileSync(e,"utf8")).split("\n").forEach(e=>{const n=e.match(/^\s*([\w\.\-]+)\s*=\s*(.*)?\s*$/);if(null!==n){let e=n[2]||"";e.length>0&&'"'===e.charAt(0)&&'"'===e.charAt(e.length-1)&&(e=e.replace(/\\n/gm,"\n")),t[n[1]]=e.replace(/(^['"]|['"]$)/g,"")}}),t}catch(t){throw new Error(`Cannot load environment variables from file ${e}`)}},t.getCurrentGoWorkspaceFromGOPATH=function(e,t){if(!e)return"";const n=e.split(r.delimiter);let o="";const s=p(t);for(const e of n){const t=r.join(e,"src");s&&(s.startsWith(t)||"win32"===process.platform&&s.toLowerCase().startsWith(t.toLowerCase()))&&t.length>o.length&&(o=s.substr(0,t.length))}return o},t.fixDriveCasingInWindows=p,t.getToolFromToolPath=function(e){if(!e)return;let t=r.basename(e);return"win32"===process.platform&&t.endsWith(".exe")&&(t=t.substr(0,t.length-4)),t},t.getInferredGopath=function(e){if(!e)return;const t=e.toLowerCase().split(r.sep),n=t.lastIndexOf("src");return n>0?e.substr(0,t.slice(0,n).join(r.sep).length):void 0}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,a)}l((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),s=n(1),i=n(5),a=n(14),l=n(17),c=n(6);function u(e){return r.existsSync(e)}class f{constructor(){this.binPath="",this.profilePath=""}openProfile(e,t){return u(s.resolve(e))?u(s.resolve(t))?(this.binPath=e,this.profilePath=t,""):"Can not find profile data":"Can not find binary"}loadCallGraph(e,t){return new Promise((n,o)=>{const r=["tool"];r.push("pprof"),r.push("-tree"),r.push("-trim=false"),r.push(e),r.push(t);const u=[],f=new l.LineBuffer,h=e=>{e&&u.push(e)};f.onLine(e=>h(e)),f.onDone(e=>{e&&h(e)});const d=s.dirname(this.binPath),p=c.getBinPath("go");if(!p){return void o('Cannot find "go" binary. Update PATH or GOROOT appropriately')}const m=i.spawn(p,r,{cwd:d});m.stdout.on("data",e=>f.append(e.toString())),m.on("close",(e,t)=>{let r="";if((r=e?"Error: failed.":"SIGKILL"===t?"Error: terminated by user.":"").length>0)return void o(r);const[s,i]=a.parseCallGraphFromLines(u);i.length>0?o(i):s?n(s):o("Error parsing call graph")})})}closeProfile(){this.binPath="",this.profilePath="",this.callGraph=void 0}getBinPath(){return this.binPath}getProfilePath(){return this.profilePath}getCallGraph(){return o(this,void 0,void 0,function*(){if(this.callGraph)return[this.callGraph,""];try{const e=yield this.loadCallGraph(this.binPath,this.profilePath);return this.callGraph=e,[e,""]}catch(e){return[void 0,e]}})}parseCallGraph(e,t){return this.loadCallGraph(e,t)}}t.newService=function(){return new f}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,s){function i(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,a)}l((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(15),s=n(16);class i{constructor(e){this._buffer=e}ScanLines(e){return new Promise((t,n)=>{const o=new s.Readable;o.push(this._buffer),o.push(null);let i="";const a=r.createInterface({input:o,crlfDelay:1/0});a.on("line",t=>{const n=e(t);0!==n.length&&(i=n,a.close())}),a.on("close",()=>{t(i)})})}}class a{constructor(){this.name="",this.flat=0,this.flatPercent=0,this.sumPercent=0,this.cum=0,this.cumPercent=0,this.valueSuffix=""}}t.NodeLine=a;class l{constructor(){this.name="",this.calls=0,this.callsPercent=0}}t.CallLine=l;class c{constructor(e){this.node=e,this.calledFrom=[],this.calls=[]}isRootNode(){return void 0===this.calledFrom||0===this.calledFrom.length}}t.NodeLines=c;class u{constructor(){this.nodes=[]}}t.TreeNodes=u;class f{constructor(){this.nodeCache=new Map,this.rootNodes=[]}sortByCum(e){return e.sort((e,t)=>t.cum===e.cum?0:e.cum<t.cum?1:-1)}sortByCalls(e){return e.sort((e,t)=>t.calls===e.calls?0:e.calls<t.calls?1:-1)}getNodeObjs(e){const t=[];for(const n of e){const e=n.toNodeObj();t.push(e)}return t}getNode(e){if(this.nodeCache.has(e))return this.nodeCache.get(e)}setNodeCache(e){this.nodeCache=e}getRootNodes(){const e=this.getNodeObjs(this.rootNodes);return this.sortByCum(e)}getNodeCalls(e){const t=this.getNode(e);if(!t)return[];const n=t.getCallObjs();return this.sortByCalls(n)}getRootNodesJSON(){const e=this.getRootNodes();return JSON.stringify(e)}getNodeCallsJSON(e){const t=this.getNodeCalls(e);return JSON.stringify(t)}}t.CallGraph=f;class h{constructor(){this.name="",this.flat=0,this.flatPercent=0,this.sumPercent=0,this.cum=0,this.cumPercent=0,this.valueSuffix="",this.calledFrom=[],this.calls=[]}hasCalls(){return this.calls.length>0}isCalled(){return this.calledFrom.length>0}toNodeObj(){const e=new p;return e.name=this.name,e.flat=this.flat,e.flatPercent=this.flatPercent,e.sumPercent=this.sumPercent,e.cum=this.cum,e.cumPercent=this.cumPercent,e.hasCalls=this.hasCalls(),e.isCalled=this.isCalled(),e.valueSuffix=this.valueSuffix,e}getCallObjs(){const e=[];for(const t of this.calls){const n=t.toCallObj();e.push(n)}return e}}t.CallGraphNode=h;class d{constructor(){this.calls=0,this.callsPercent=0,this.isCallFrom=!1,this.node=void 0}toCallObj(){const e=new m;return e.node=this.node.toNodeObj(),e.calls=this.calls,e.callsPercent=this.callsPercent,e.isCallFrom=this.isCallFrom,e}}t.CallGraphCall=d;class p{constructor(){this.name="",this.flat=0,this.flatPercent=0,this.sumPercent=0,this.cum=0,this.cumPercent=0,this.hasCalls=!1,this.isCalled=!1,this.valueSuffix=""}}t.CallGraphNodeObj=p;class m{constructor(){this.calls=0,this.callsPercent=0,this.isCallFrom=!1,this.node=void 0}}function g(e){return 0===e.indexOf("-----")}function v(e){return 0===e.trim().indexOf("flat")}function w(e){if(e.indexOf("|")<0)return!1;const t=e.split("|");if(t.length<=1)return!1;const n=t[1];return 0!==n.indexOf("   ")&&0===n.indexOf(" ")}function C(e){if(e.indexOf("|")<0)return!1;const t=e.split("|");return!(t.length<=1)&&0===t[1].indexOf("   ")}function P(e){return x(e,["s","KB","MB","GB"])}function b(e){const[t,n,o,r]=x(e,["%"]);return[t,n,r]}function x(e,t){const n=e.trim();let o="";if(0===n.length)return[0,"",o,"Can't parse empty string"];const r=n.indexOf(" ");if(r<0){let e=n,r=!1;for(const n of t)if(e.endsWith(n)){o=n,r=!0;break}if(!r)return[0,"",o,"Can not parse"];return e=e.slice(0,e.length-o.length),[parseFloat(e),"",o,""]}let s=n.slice(0,r);for(const e of t)if(s.endsWith(e)){o=e,s=s.slice(0,s.length-o.length);break}const i=n.slice(r);return[parseFloat(s),i,o,""]}function N(e){if(0===e.length)return[void 0,"Can not parse node line"];if(!w(e))return[void 0,"Can not parse node line"];if(e.indexOf("|")<0)return[void 0,"Can not parse node line"];const t=e.split("|");if(t.length<=1)return[void 0,"Can not parse node line"];let n=t[0],o=t[1];o=o.trim();const r=new a;r.name=o;let s=0,i="",l="";if([s,n,l,i]=P(n),0!==i.length)return[void 0,"Can not parse node line"];let c=0;if([c,n,i]=b(n),0!==i.length)return[void 0,"Can not parse node line"];let u=0;if([u,n,i]=b(n),0!==i.length)return[void 0,"Can not parse node line"];let f=0;if([f,n,l,i]=P(n),0!==i.length)return[void 0,"Can not parse node line"];let h=0;return[h,n,i]=b(n),0!==i.length?[void 0,"Can not parse node line"]:(r.flat=s,r.flatPercent=c,r.sumPercent=u,r.cum=f,r.cumPercent=h,r.valueSuffix=l,[r,""])}function y(e){if(0===e.length)return[void 0,"Can not parse call line"];if(!C(e))return[void 0,"Can not parse call line"];if(e.indexOf("|")<0)return[void 0,"Can not parse call line"];const t=e.split("|");if(t.length<=1)return[void 0,"Can not parse call line"];let n=t[0],o=t[1];o=o.trim();const r=new l;r.name=o;let s=0,i="",a="";if([s,n,a,i]=P(n),0!==i.length)return[void 0,"Can not parse call line"];let c=0;return[c,n,i]=b(n),0!==i.length?[void 0,"Can not parse call line"]:(r.calls=s,r.callsPercent=c,[r,""])}function O(e){if(0===e.length)return[void 0,"Can not parse node lines"];const t=[],n=[];let o;for(const r of e){let e="";if(C(r)){let s;if([s,e]=y(r),0!==e.length)return[void 0,e];if(!s)continue;o?n.push(s):t.push(s)}else if(w(r)){let t;if([t,e]=N(r),0!==e.length)return[void 0,e];o=t}}if(!o)return[void 0,"Can not parse node lines"];const r=new c(o);return r.calledFrom=t,r.calls=n,[r,""]}t.CallGraphCallObj=m,t.isDelimiter=g,t.isHeader=v,t.isNodeLine=w,t.isCallLine=C,t.parseSecondsOrMb=P,t.parsePercent=b,t.parseNodeLine=N,t.parseCallLine=y,t.parseNodeLines=O;class G{constructor(){this.sawHeader=!1,this.lines=[],this.nodeLines=[]}parseTreeNodeLine(e){if(0===e.length)return"";if(v(e))return this.sawHeader=!0,"";if(g(e)){if(0===this.lines.length)return"";const[e,t]=O(this.lines);return 0!==t.length?t:(e&&this.nodeLines.push(e),this.lines=[],"")}return this.sawHeader&&this.lines.push(e),""}getNodeLines(){return this.nodeLines}}function F(e){return o(this,void 0,void 0,function*(){const t=new i(e),n=new G,o=yield t.ScanLines(e=>n.parseTreeNodeLine(e));if(0!==o.length)return[void 0,o];const r=new u;return r.nodes=n.getNodeLines(),[r,""]})}function L(e){const t=new G;let n="";for(const o of e)if((n=t.parseTreeNodeLine(o)).length>0)break;if(0!==n.length)return[void 0,n];const o=new u;return o.nodes=t.getNodeLines(),[o,""]}function _(e){if(!e)return;const t=new Map,n=[];for(const o of e.nodes){const e=o.node;if(!t.has(e.name)){const r=new h;r.name=e.name,r.flat=e.flat,r.flatPercent=e.flatPercent,r.sumPercent=e.sumPercent,r.cum=e.cum,r.cumPercent=e.cumPercent,r.valueSuffix=e.valueSuffix,t.set(e.name,r),o.isRootNode()&&n.push(r)}}for(const n of e.nodes){const e=n.node;if(t.has(e.name)){const o=t.get(e.name);if(o){const e=T(t,n.calledFrom),r=k(t,n.calls);o.calledFrom=e,o.calls=r}}}const o=new f;return o.rootNodes=n,o.setNodeCache(t),o}function T(e,t){const n=[];for(const o of t)if(e.has(o.name)){const t=e.get(o.name);if(t){const e=new d;e.node=t,e.calls=o.calls,e.callsPercent=o.callsPercent,e.isCallFrom=!0,n.push(e)}}return n}function k(e,t){const n=[];for(const o of t)if(e.has(o.name)){const t=e.get(o.name);if(t){const e=new d;e.node=t,e.calls=o.calls,e.callsPercent=o.callsPercent,e.isCallFrom=!1,n.push(e)}}return n}function S(e){let t="";for(const n of e)t+=n;return t}function j(e){let t="";for(let n=0;n<e;n++)t+=" ";return t}function E(e,t,n,o){if(!t)return;const r=j(o);let s="";s="v"===n?r+t.name+" "+t.flat.toFixed(2)+"s "+t.flatPercent.toFixed(2)+"% "+t.sumPercent.toFixed(2)+"% "+t.cum.toFixed(2)+"s "+t.cumPercent.toFixed(2)+"%\n":r+t.name+"\n",e.push(s),M(e,t.calls,n,o+1)}function M(e,t,n,o){for(const r of t)B(e,r,n,o)}function B(e,t,n,o){if(!t)return;const r=t.node;if(!r)return;const s=j(o);let i="";i="v"===n?s+r.name+" "+r.flat.toFixed(2)+"s "+r.flatPercent.toFixed(2)+"% "+r.sumPercent.toFixed(2)+"% "+r.cum.toFixed(2)+"s "+r.cumPercent.toFixed(2)+"% "+t.calls.toFixed(2)+"s "+t.callsPercent.toFixed(2)+"%\n":s+r.name+"\n",e.push(i),M(e,r.calls,n,o+1)}function D(e,t){const n=(o=t,new Intl.NumberFormat("en-IN",{maximumFractionDigits:2}).format(o));var o;e.push(n),e.push("s")}t.parseTreeNodes=F,t.parseTreeNodesFromLines=L,t.parseCallGraph=function(e){return o(this,void 0,void 0,function*(){const[t,n]=yield F(e);return 0!==n.length?[void 0,n]:[_(t),""]})},t.parseCallGraphFromLines=function(e){const[t,n]=L(e);return 0!==n.length?[void 0,n]:[_(t),""]},t.newCallGraph=_,t.dumpCallGraph=function(e,t){const n=[];return function(e,t,n,o){for(const r of t)E(e,r,n,o)}(n,e.rootNodes,t,0),S(n)},t.openRootNodes=function(e){const t=e.getRootNodesJSON(),n=JSON.parse(t),o=[];for(const e of n)o.push(e.name),o.push(" "),D(o,e.cum),o.push("\n");return[S(o),""]},t.openChildNodes=function(e,t){const n=e.getNodeCallsJSON(t),o=JSON.parse(n),r=[];for(const e of o)r.push(e.node.name),r.push(" "),D(r,e.calls),r.push("\n");return[S(r),""]}},function(e,t){e.exports=require("readline")},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LineBuffer=class{constructor(){this.buf="",this.lineListeners=[],this.lastListeners=[]}append(e){for(this.buf+=e;;){const e=this.buf.indexOf("\n");if(-1===e)break;this.fireLine(this.buf.substring(0,e)),this.buf=this.buf.substring(e+1)}}done(){this.fireDone(""!==this.buf?this.buf:void 0)}fireLine(e){this.lineListeners.forEach(t=>t(e))}fireDone(e){this.lastListeners.forEach(t=>t(e))}onLine(e){this.lineListeners.push(e)}onDone(e){this.lastListeners.push(e)}}}]);
//# sourceMappingURL=extension.js.map